<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ACA 历史价格图表</title>

<!-- Chart.js 主库 -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- Chart.js 金融图表插件（支持K线） -->
<script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial@3.3.0"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background-color: #0f111a;
  color: #f2f2f2;
  text-align: center;
  margin: 0;
  padding: 0;
}
h1 {
  color: #00ff88;
  margin-top: 30px;
}
.buttons {
  margin-top: 10px;
}
button {
  background: #222;
  color: #f2f2f2;
  border: 1px solid #555;
  padding: 8px 14px;
  margin: 0 5px;
  border-radius: 6px;
  cursor: pointer;
  transition: 0.2s;
}
button:hover {
  background: #00ff88;
  color: #000;
}
canvas {
  max-width: 95%;
  margin: 30px auto;
  display: block;
}
.price-box {
  font-size: 0.9em;
  color: #ccc;
  margin-bottom: 25px;
}
</style>
</head>

<body>
  <h1>ACA / USDT 历史价格</h1>

  <div class="buttons">
    <button onclick="loadData('1h')">1小时</button>
    <button onclick="loadData('1D')">1天</button>
    <button onclick="loadData('4h')">1月</button>
  </div>

  <canvas id="chartCanvas" width="800" height="400"></canvas>

  <div id="realtimePrice" class="price-box">实时价格加载中...</div>

<script>
let chart;
const ctx = document.getElementById('chartCanvas').getContext('2d');

// 初始化图表
function createChart(data) {
  if (chart) chart.destroy();
  chart = new Chart(ctx, {
    type: 'candlestick',
    data: { datasets: [{ label: 'ACA/USDT', data: data,
      borderColor: '#aaa',
      color: {
        up: '#00ff88',    // 上涨蜡烛
        down: '#ff4444',  // 下跌蜡烛
        unchanged: '#999'
      }
    }]},
    options: {
      plugins: {
        legend: { labels: { color: '#ccc' } }
      },
      scales: {
        x: {
          ticks: { color: '#ccc' },
          grid: { color: '#222' }
        },
        y: {
          ticks: { color: '#ccc' },
          grid: { color: '#222' }
        }
      }
    }
  });
}

// 加载历史数据
async function loadData(period) {
  const map = { "1h": "1h", "1D": "1D", "4h": "4h" };
  const bar = map[period];
  const url = `https://www.okx.com/api/v5/market/candles?instId=ACA-USDT&bar=${bar}&limit=100`;
  const res = await fetch(url);
  const json = await res.json();
  const arr = json.data.reverse();

  // 转换成 Chart.js 需要的格式
  const data = arr.map(d => ({
    x: new Date(parseInt(d[0])),
    o: parseFloat(d[1]),
    h: parseFloat(d[2]),
    l: parseFloat(d[3]),
    c: parseFloat(d[4])
  }));

  createChart(data);
}
loadData('1h'); // 默认加载1小时图

// === 实时价格刷新 ===
let lastPrice = null;
async function updatePrice() {
  try {
    const res = await fetch('https://www.okx.com/api/v5/market/ticker?instId=ACA-USDT');
    const data = await res.json();
    const price = parseFloat(data.data[0].last).toFixed(6);
    const el = document.getElementById('realtimePrice');
    if (lastPrice !== null) {
      el.style.color = price > lastPrice ? '#00ff88' : price < lastPrice ? '#ff4444' : '#ccc';
    }
    el.innerText = `实时价格：${price} USD （${new Date().toLocaleTimeString()}）`;
    lastPrice = price;
  } catch {
    document.getElementById('realtimePrice').innerText = '实时价格获取失败';
  }
}
updatePrice();
setInterval(updatePrice, 3000);
</script>
</body>
</html>
